openapi: 3.0.3
info:
  title: Zoea Super App API
  description: Comprehensive API for Zoea Super App - Listings, Bookings, Payments, and more
  version: 2.0.0
  contact:
    name: Zoea API Support
    email: api@zoearwanda.com

servers:
  - url: https://api.zoearwanda.com/v2
    description: Production server
  - url: https://staging-api.zoearwanda.com/v2
    description: Staging server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    apiKey:
      type: apiKey
      in: header
      name: X-API-Key
  
  schemas:
    # Common Schemas
    Pagination:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        total_pages:
          type: integer
          example: 5
        total_items:
          type: integer
          example: 125
        items_per_page:
          type: integer
          example: 25
        has_next:
          type: boolean
          example: true
        has_prev:
          type: boolean
          example: false
    
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Invalid request parameters"
        code:
          type: string
          example: "VALIDATION_ERROR"
        details:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: "email"
              message:
                type: string
                example: "Invalid email format"
    
    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed successfully"
    
    # User Schemas
    User:
      type: object
      properties:
        user_id:
          type: integer
          example: 12345
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          example: "john.doe@example.com"
        phone_number:
          type: string
          example: "+250788123456"
        avatar_url:
          type: string
          example: "https://cdn.zoearwanda.com/avatars/user12345.jpg"
        default_city:
          type: string
          example: "Kigali"
        is_verified:
          type: boolean
          example: true
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
    
    UserCreate:
      type: object
      required:
        - first_name
        - last_name
        - email
        - password
        - phone_number
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        email:
          type: string
          example: "john.doe@example.com"
        password:
          type: string
          example: "securePassword123"
        phone_number:
          type: string
          example: "+250788123456"
        avatar_url:
          type: string
          example: "https://cdn.zoearwanda.com/avatars/user12345.jpg"
        default_city:
          type: string
          example: "Kigali"
        agent_code:
          type: string
          example: "AGENT123"
          description: "Optional referral code from agent"
    
    AuthTokens:
      type: object
      properties:
        access_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.access"
        refresh_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.refresh"
        token_type:
          type: string
          example: "Bearer"
        expires_in:
          type: integer
          example: 3600

    AuthUserResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Login successful"
        data:
          type: object
          properties:
            user:
              $ref: '#/components/schemas/User'
            tokens:
              $ref: '#/components/schemas/AuthTokens'

    AuthTokenResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Token refreshed successfully"
        data:
          $ref: '#/components/schemas/AuthTokens'

    AuthLoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"
        password:
          type: string
          format: password
          example: "securePassword123"
        device_id:
          type: string
          example: "ios-device-123"

    LogoutRequest:
      type: object
      properties:
        refresh_token:
          type: string
          description: "Refresh token to revoke"
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.refresh"
        device_id:
          type: string
          description: "Optional device identifier for session management"
          example: "ios-device-123"

    RefreshTokenRequest:
      type: object
      required:
        - refresh_token
      properties:
        refresh_token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.refresh"
        device_id:
          type: string
          example: "ios-device-123"

    ForgotPasswordRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: "john.doe@example.com"

    ResetPasswordRequest:
      type: object
      required:
        - token
        - password
      properties:
        token:
          type: string
          description: "Password reset token received via email"
          example: "RESET-123456"
        password:
          type: string
          format: password
          example: "NewSecurePassword#2024"
        confirm_password:
          type: string
          format: password
          example: "NewSecurePassword#2024"

    VerifyEmailRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          description: "Email verification token"
          example: "VERIFY-123456"

    UserUpdate:
      type: object
      required:
        - first_name
        - last_name
        - phone_number
      properties:
        first_name:
          type: string
          example: "John"
        last_name:
          type: string
          example: "Doe"
        phone_number:
          type: string
          example: "+250788123456"
        default_city:
          type: string
          example: "Kigali"
        avatar_url:
          type: string
          example: "https://cdn.zoearwanda.com/avatars/user12345.jpg"

    UserPatch:
      type: object
      properties:
        first_name:
          type: string
        last_name:
          type: string
        phone_number:
          type: string
        default_city:
          type: string
        avatar_url:
          type: string

    AvatarUpdateRequest:
      type: object
      required:
        - avatar_url
      properties:
        avatar_url:
          type: string
          format: uri
          example: "https://cdn.zoearwanda.com/avatars/user12345.jpg"

    SavedLocation:
      type: object
      properties:
        saved_location_id:
          type: integer
          example: 10
        label:
          type: string
          example: "Home"
        city:
          type: string
          example: "Kigali"
        district:
          type: string
          example: "Gasabo"
        neighborhood:
          type: string
          example: "Kacyiru"
        address_line_1:
          type: string
          example: "KN 4 Ave"
        address_line_2:
          type: string
          example: "Apartment 2B"
        latitude:
          type: number
          format: float
          example: -1.9441
        longitude:
          type: number
          format: float
          example: 30.0619
        created_at:
          type: string
          format: date-time
          example: "2024-01-20T08:15:00Z"

    SavedLocationCreate:
      type: object
      required:
        - label
        - city
      properties:
        label:
          type: string
          example: "Home"
        city:
          type: string
          example: "Kigali"
        district:
          type: string
          example: "Gasabo"
        neighborhood:
          type: string
          example: "Kacyiru"
        address_line_1:
          type: string
          example: "KN 4 Ave"
        address_line_2:
          type: string
          example: "Apartment 2B"
        latitude:
          type: number
          format: float
          example: -1.9441
        longitude:
          type: number
          format: float
          example: 30.0619

    SavedLocationUpdate:
      type: object
      properties:
        label:
          type: string
        city:
          type: string
        district:
          type: string
        neighborhood:
          type: string
        address_line_1:
          type: string
        address_line_2:
          type: string
        latitude:
          type: number
          format: float
        longitude:
          type: number
          format: float

    FavoriteRequest:
      type: object
      required:
        - listing_id
      properties:
        listing_id:
          type: integer
          example: 5001

    SearchHistoryEntry:
      type: object
      properties:
        search_id:
          type: integer
          example: 25
        search_query:
          type: string
          example: "Hotels in Kigali"
        filters:
          type: object
          additionalProperties: true
          example:
            category: "hotel"
            rating_min: 4
        location:
          type: string
          example: "Kigali"
        searched_at:
          type: string
          format: date-time
          example: "2024-02-10T12:00:00Z"

    # Location Schemas
    Location:
      type: object
      properties:
        location_id:
          type: integer
          example: 1
        merchant_id:
          type: integer
          example: 1001
        address_line_1:
          type: string
          example: "KN 4 Ave"
        address_line_2:
          type: string
          example: "Kacyiru"
        city:
          type: string
          example: "Kigali"
        district:
          type: string
          example: "Gasabo"
        neighborhood:
          type: string
          example: "Kacyiru"
        latitude:
          type: number
          format: float
          example: -1.9441
        longitude:
          type: number
          format: float
          example: 30.0619
        timezone:
          type: string
          example: "Africa/Kigali"
    
    # Listing Base Schema
    ListingBase:
      type: object
      properties:
        listing_id:
          type: integer
          example: 5001
        merchant_id:
          type: integer
          example: 1001
        title:
          type: string
          example: "Kigali Marriott Hotel"
        description:
          type: string
          example: "Luxury hotel in the heart of Kigali"
        type:
          type: string
          enum: [hotel, event, restaurant, tour, product, service]
          example: "hotel"
        base_price:
          type: number
          format: float
          example: 150.00
        is_active:
          type: boolean
          example: true
        operating_hours:
          type: object
          example: {"monday": "09:00-18:00", "tuesday": "09:00-18:00"}
        created_at:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00Z"
        updated_at:
          type: string
          format: date-time
          example: "2024-01-20T15:45:00Z"
    
    # Hotel Specific Schemas
    HotelRoomType:
      type: object
      properties:
        room_type_id:
          type: integer
          example: 1
        listing_id:
          type: integer
          example: 5001
        name:
          type: string
          example: "Deluxe King Room"
        description:
          type: string
          example: "Spacious room with king bed and city view"
        max_occupancy:
          type: integer
          example: 2
        total_rooms:
          type: integer
          example: 10
        amenities:
          type: array
          items:
            type: string
          example: ["wifi", "air_conditioning", "tv", "minibar"]
        board_type:
          type: string
          enum: [RO, BB, HB, AI]
          example: "BB"
        is_refundable:
          type: boolean
          example: true
        base_price:
          type: number
          format: float
          example: 200.00
        room_config:
          type: object
          example: {"bed_type": "king", "size_sqm": 35, "smoking": false}
    
    RatePlan:
      type: object
      properties:
        rate_plan_id:
          type: integer
          example: 1
        room_type_id:
          type: integer
          example: 1
        name:
          type: string
          example: "Early Bird Discount"
        board_type:
          type: string
          enum: [RO, BB, HB, AI]
          example: "BB"
        is_refundable:
          type: boolean
          example: true
        price:
          type: number
          format: float
          example: 180.00
        currency:
          type: string
          example: "USD"
        min_stay:
          type: integer
          example: 1
        max_stay:
          type: integer
          example: 14
        restrictions:
          type: object
          example: {"min_advance_booking": 2, "closed_to_arrival": false}
        blackout_dates:
          type: array
          items:
            type: string
            format: date
          example: ["2024-12-25", "2024-12-31"]
    
    # Restaurant Specific Schema
    RestaurantTable:
      type: object
      properties:
        table_id:
          type: integer
          example: 1
        listing_id:
          type: integer
          example: 5002
        table_type:
          type: string
          enum: [indoor, outdoor, private]
          example: "indoor"
        capacity:
          type: integer
          example: 4
        table_count:
          type: integer
          example: 8
        min_booking_duration_minutes:
          type: integer
          example: 90
    
    # Event Specific Schema
    Event:
      type: object
      properties:
        event_id:
          type: integer
          example: 1
        listing_id:
          type: integer
          example: 5003
        event_name:
          type: string
          example: "Kigali Jazz Festival"
        event_date:
          type: string
          format: date-time
          example: "2024-03-15T19:00:00Z"
        end_date:
          type: string
          format: date-time
          example: "2024-03-15T23:00:00Z"
        venue_name:
          type: string
          example: "Kigali Convention Center"
        total_tickets:
          type: integer
          example: 1000
        available_tickets:
          type: integer
          example: 250
        ticket_tiers:
          type: array
          items:
            type: object
            properties:
              tier_name:
                type: string
                example: "VIP"
              price:
                type: number
                format: float
                example: 75.00
              available:
                type: integer
                example: 50
        is_recurring:
          type: boolean
          example: false
    
    # Complete Listing with Polymorphic Data
    Listing:
      allOf:
        - $ref: '#/components/schemas/ListingBase'
        - type: object
          properties:
            location:
              $ref: '#/components/schemas/Location'
            gallery_images:
              type: array
              items:
                type: string
              example: ["https://cdn.zoearwanda.com/listings/5001/1.jpg"]
            hotel_room_types:
              type: array
              items:
                $ref: '#/components/schemas/HotelRoomType'
            restaurant_tables:
              type: array
              items:
                $ref: '#/components/schemas/RestaurantTable'
            events:
              type: array
              items:
                $ref: '#/components/schemas/Event'
            products:
              type: array
              items:
                $ref: '#/components/schemas/Product'
            services:
              type: array
              items:
                $ref: '#/components/schemas/ServiceOffering'
            tours:
              type: array
              items:
                $ref: '#/components/schemas/TourPackage'
    
    # Booking Schemas
    Booking:
      type: object
      properties:
        booking_id:
          type: integer
          example: 8001
        user_id:
          type: integer
          example: 12345
        listing_id:
          type: integer
          example: 5001
        resource_id:
          type: integer
          example: 1
        booking_type:
          type: string
          enum: [hotel_stay, event_ticket, restaurant, tour, product, service]
          example: "hotel_stay"
        status:
          type: string
          enum: [pending, confirmed, checked_in, completed, cancelled, no_show]
          example: "confirmed"
        start_time:
          type: string
          format: date-time
          example: "2024-03-20T14:00:00Z"
        end_time:
          type: string
          format: date-time
          example: "2024-03-22T11:00:00Z"
        quantity:
          type: integer
          example: 1
        guest_count:
          type: integer
          example: 2
        base_amount:
          type: number
          format: float
          example: 400.00
        tax_amount:
          type: number
          format: float
          example: 40.00
        service_fee:
          type: number
          format: float
          example: 20.00
        total_amount:
          type: number
          format: float
          example: 460.00
        currency:
          type: string
          example: "USD"
        booking_details:
          type: object
          example: {"room_type": "Deluxe King", "breakfast_included": true}
        special_requests:
          type: string
          example: "Late checkout requested"
        confirmation_code:
          type: string
          example: "ZOA-HTL-2024-8001"
        created_at:
          type: string
          format: date-time
          example: "2024-03-01T10:15:00Z"
    
    # Search and Filter Parameters
    SearchParams:
      type: object
      properties:
        query:
          type: string
          description: "Search query string"
          example: "hotel"
        location:
          type: string
          description: "City, district or neighborhood"
          example: "Kigali"
        latitude:
          type: number
          format: float
          description: "User's current latitude for nearby search"
          example: -1.9441
        longitude:
          type: number
          format: float
          description: "User's current longitude for nearby search"
          example: 30.0619
        radius:
          type: integer
          description: "Search radius in kilometers"
          example: 10
        category:
          type: string
          enum: [hotel, restaurant, event, tour, product, service]
          example: "hotel"
        price_min:
          type: number
          format: float
          example: 50
        price_max:
          type: number
          format: float
          example: 200
        rating_min:
          type: integer
          minimum: 1
          maximum: 5
          example: 4
        tags:
          type: array
          items:
            type: string
          example: ["wifi", "parking", "pool"]
        date_from:
          type: string
          format: date
          example: "2024-03-20"
        date_to:
          type: string
          format: date
          example: "2024-03-22"
        guests:
          type: integer
          example: 2
        sort_by:
          type: string
          enum: [distance, rating, price_low, price_high, popularity]
          example: "rating"
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20

paths:
  # AUTH ENDPOINTS
  /api/v1/auth/register:
    post:
      summary: Register a new user
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthUserResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/login:
    post:
      summary: Authenticate user credentials
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthLoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthUserResponse'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/logout:
    post:
      summary: Invalidate the current session
      tags: [Authentication]
      security:
        - bearerAuth: []
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LogoutRequest'
      responses:
        '200':
          description: Logout completed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/auth/refresh-token:
    post:
      summary: Refresh access tokens
      tags: [Authentication]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenRequest'
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokenResponse'
        '401':
          description: Invalid refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/forgot-password:
    post:
      summary: Request password reset link
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ForgotPasswordRequest'
      responses:
        '200':
          description: Password reset email sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/auth/reset-password:
    post:
      summary: Reset password using a reset token
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/v1/auth/verify-email:
    post:
      summary: Verify a user's email address
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VerifyEmailRequest'
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          description: Invalid verification token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # USER ENDPOINTS
  /api/v1/users/me:
    get:
      summary: Get current user profile
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
    put:
      summary: Update user profile (replace)
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: User profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
    patch:
      summary: Partially update user profile
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserPatch'
      responses:
        '200':
          description: User profile updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'
    delete:
      summary: Delete user account
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Account deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/users/{user_id}:
    get:
      summary: Get public profile for a user
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'

  /api/v1/users/{user_id}/avatar:
    put:
      summary: Update a user's avatar image
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AvatarUpdateRequest'
      responses:
        '200':
          description: Avatar updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/User'

  /api/v1/users/me/saved-locations:
    get:
      summary: List saved locations for current user
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Saved locations retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/SavedLocation'
    post:
      summary: Create a saved location
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SavedLocationCreate'
      responses:
        '201':
          description: Saved location created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/SavedLocation'

  /api/v1/users/me/saved-locations/{saved_location_id}:
    put:
      summary: Update a saved location
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: saved_location_id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SavedLocationUpdate'
      responses:
        '200':
          description: Saved location updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/SavedLocation'
    delete:
      summary: Delete a saved location
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: saved_location_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Saved location deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/users/me/favorites:
    get:
      summary: Get user's favorite listings
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Favorites retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      favorites:
                        type: array
                        items:
                          $ref: '#/components/schemas/Listing'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
    post:
      summary: Add listing to favorites
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FavoriteRequest'
      responses:
        '201':
          description: Listing added to favorites
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/users/me/favorites/{listing_id}:
    delete:
      summary: Remove listing from favorites
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: listing_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Listing removed from favorites
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/users/me/search-history:
    get:
      summary: Get saved search history
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Search history retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      history:
                        type: array
                        items:
                          $ref: '#/components/schemas/SearchHistoryEntry'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
    delete:
      summary: Clear entire search history
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Search history cleared
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  /api/v1/users/me/search-history/{search_id}:
    delete:
      summary: Remove a specific search entry
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: search_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Search history entry deleted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # LISTINGS ENDPOINTS
  /listings:
    get:
      summary: Search and filter listings
      tags: [Listings]
      parameters:
        - in: query
          name: query
          schema:
            type: string
          description: Search query
        - in: query
          name: location
          schema:
            type: string
          description: City, district or neighborhood
        - in: query
          name: latitude
          schema:
            type: number
            format: float
          description: User's current latitude
        - in: query
          name: longitude
          schema:
            type: number
            format: float
          description: User's current longitude
        - in: query
          name: radius
          schema:
            type: integer
          description: Search radius in km
        - in: query
          name: category
          schema:
            type: string
            enum: [hotel, restaurant, event, tour, product, service]
          description: Listing category
        - in: query
          name: price_min
          schema:
            type: number
            format: float
          description: Minimum price
        - in: query
          name: price_max
          schema:
            type: number
            format: float
          description: Maximum price
        - in: query
          name: rating_min
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: Minimum rating
        - in: query
          name: date_from
          schema:
            type: string
            format: date
          description: Check-in/event start date
        - in: query
          name: date_to
          schema:
            type: string
            format: date
          description: Check-out/event end date
        - in: query
          name: guests
          schema:
            type: integer
          description: Number of guests
        - in: query
          name: sort_by
          schema:
            type: string
            enum: [distance, rating, price_low, price_high, popularity]
          description: Sort results by
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            default: 20
            maximum: 100
          description: Items per page
      responses:
        '200':
          description: Listings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      listings:
                        type: array
                        items:
                          $ref: '#/components/schemas/Listing'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
                      filters:
                        type: object
                        properties:
                          applied:
                            $ref: '#/components/schemas/SearchParams'
                          available:
                            type: object
                            example:
                              categories: ["hotel", "restaurant", "event"]
                              price_ranges: [{"min": 0, "max": 50}, {"min": 50, "max": 100}]
          examples:
            hotel_listing:
              summary: Hotel listing response
              value:
                success: true
                data:
                  listings:
                    - listing_id: 5001
                      merchant_id: 1001
                      title: "Kigali Marriott Hotel"
                      description: "Luxury hotel in the heart of Kigali"
                      type: "hotel"
                      base_price: 150.00
                      is_active: true
                      location:
                        location_id: 1
                        address_line_1: "KN 4 Ave"
                        city: "Kigali"
                        district: "Gasabo"
                        latitude: -1.9441
                        longitude: 30.0619
                      gallery_images: ["https://cdn.zoearwanda.com/listings/5001/1.jpg"]
                      hotel_room_types:
                        - room_type_id: 1
                          name: "Deluxe King Room"
                          description: "Spacious room with king bed"
                          max_occupancy: 2
                          total_rooms: 10
                          amenities: ["wifi", "air_conditioning", "tv"]
                          base_price: 200.00
                      restaurant_tables: []
                      events: []
                  pagination:
                    current_page: 1
                    total_pages: 5
                    total_items: 95
                    items_per_page: 20
                    has_next: true
                    has_prev: false

    post:
      summary: Create a new listing (Merchant only)
      tags: [Listings]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [merchant_id, title, type, base_price]
              properties:
                merchant_id:
                  type: integer
                  example: 1001
                title:
                  type: string
                  example: "New Restaurant"
                description:
                  type: string
                  example: "A great new restaurant"
                type:
                  type: string
                  enum: [hotel, event, restaurant, tour, product, service]
                  example: "restaurant"
                base_price:
                  type: number
                  format: float
                  example: 25.00
                location:
                  $ref: '#/components/schemas/Location'
                hotel_room_types:
                  type: array
                  items:
                    $ref: '#/components/schemas/HotelRoomType'
                restaurant_tables:
                  type: array
                  items:
                    $ref: '#/components/schemas/RestaurantTable'
      responses:
        '201':
          description: Listing created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Listing created successfully"
                  data:
                    $ref: '#/components/schemas/Listing'

  /listings/{listing_id}:
    get:
      summary: Get listing details by ID
      tags: [Listings]
      parameters:
        - in: path
          name: listing_id
          required: true
          schema:
            type: integer
          description: Listing ID
      responses:
        '200':
          description: Listing details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Listing'
          examples:
            hotel_detail:
              summary: Hotel listing detail
              value:
                success: true
                data:
                  listing_id: 5001
                  merchant_id: 1001
                  title: "Kigali Marriott Hotel"
                  description: "Luxury 5-star hotel in Kigali city center"
                  type: "hotel"
                  base_price: 150.00
                  is_active: true
                  location:
                    location_id: 1
                    address_line_1: "KN 4 Ave"
                    city: "Kigali"
                    district: "Gasabo"
                    neighborhood: "Kacyiru"
                    latitude: -1.9441
                    longitude: 30.0619
                  gallery_images: 
                    - "https://cdn.zoearwanda.com/listings/5001/1.jpg"
                    - "https://cdn.zoearwanda.com/listings/5001/2.jpg"
                  hotel_room_types:
                    - room_type_id: 1
                      name: "Deluxe King Room"
                      description: "Spacious room with king bed and city view"
                      max_occupancy: 2
                      total_rooms: 10
                      amenities: ["wifi", "air_conditioning", "tv", "minibar", "safe"]
                      board_type: "BB"
                      is_refundable: true
                      base_price: 200.00
                      rate_plans:
                        - rate_plan_id: 1
                          name: "Standard Rate"
                          price: 200.00
                          is_refundable: true
                          min_stay: 1
                          max_stay: 14
            restaurant_detail:
              summary: Restaurant listing detail
              value:
                success: true
                data:
                  listing_id: 5002
                  merchant_id: 1002
                  title: "Heaven Restaurant & Boutique Hotel"
                  description: "Panoramic views of Kigali with international cuisine"
                  type: "restaurant"
                  base_price: 35.00
                  is_active: true
                  location:
                    location_id: 2
                    address_line_1: "KG 7 Ave"
                    city: "Kigali"
                    district: "Kicukiro"
                    latitude: -1.9686
                    longitude: 30.1044
                  gallery_images: 
                    - "https://cdn.zoearwanda.com/listings/5002/1.jpg"
                  restaurant_tables:
                    - table_id: 1
                      table_type: "outdoor"
                      capacity: 4
                      table_count: 12
                      min_booking_duration_minutes: 90
                    - table_id: 2
                      table_type: "private"
                      capacity: 8
                      table_count: 2
                      min_booking_duration_minutes: 120

  # BOOKINGS ENDPOINTS
  /bookings:
    get:
      summary: Get user's bookings
      tags: [Bookings]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, confirmed, checked_in, completed, cancelled, no_show]
          description: Filter by booking status
        - in: query
          name: type
          schema:
            type: string
            enum: [hotel_stay, event_ticket, restaurant, tour, product, service]
          description: Filter by booking type
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Items per page
      responses:
        '200':
          description: Bookings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      bookings:
                        type: array
                        items:
                          $ref: '#/components/schemas/Booking'
                      pagination:
                        $ref: '#/components/schemas/Pagination'

    post:
      summary: Create a new booking
      tags: [Bookings]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [listing_id, resource_id, booking_type, start_time, end_time, quantity]
              properties:
                listing_id:
                  type: integer
                  example: 5001
                resource_id:
                  type: integer
                  example: 1
                booking_type:
                  type: string
                  enum: [hotel_stay, event_ticket, restaurant, tour, product, service]
                  example: "hotel_stay"
                start_time:
                  type: string
                  format: date-time
                  example: "2024-03-20T14:00:00Z"
                end_time:
                  type: string
                  format: date-time
                  example: "2024-03-22T11:00:00Z"
                quantity:
                  type: integer
                  example: 1
                guest_count:
                  type: integer
                  example: 2
                special_requests:
                  type: string
                  example: "Late checkout requested"
                participants:
                  type: array
                  items:
                    type: object
                    properties:
                      full_name:
                        type: string
                        example: "John Doe"
                      email:
                        type: string
                        example: "john.doe@example.com"
                addons:
                  type: array
                  items:
                    type: object
                    properties:
                      addon_type:
                        type: string
                        example: "breakfast"
                      quantity:
                        type: integer
                        example: 2
      responses:
        '201':
          description: Booking created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Booking created successfully"
                  data:
                    $ref: '#/components/schemas/Booking'

  /bookings/{booking_id}:
    get:
      summary: Get booking details
      tags: [Bookings]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: booking_id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Booking details retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Booking'

    patch:
      summary: Update booking (cancel, modify)
      tags: [Bookings]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: booking_id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [cancelled]
                  example: "cancelled"
                cancellation_reason:
                  type: string
                  example: "Change of plans"
      responses:
        '200':
          description: Booking updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # PAYMENTS ENDPOINTS
  /payments/initiate:
    post:
      summary: Initiate a payment
      tags: [Payments]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [booking_id, payment_method, amount]
              properties:
                booking_id:
                  type: integer
                  example: 8001
                payment_method:
                  type: string
                  enum: [irembo_pay, momo, airtel, card]
                  example: "momo"
                amount:
                  type: number
                  format: float
                  example: 460.00
                payment_type:
                  type: string
                  enum: [full, deposit, installment]
                  example: "full"
                is_split_payment:
                  type: boolean
                  example: false
      responses:
        '200':
          description: Payment initiated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      payment_id:
                        type: integer
                        example: 9001
                      transaction_id:
                        type: string
                        example: "TXN_2024_8001"
                      payment_url:
                        type: string
                        example: "https://payment.zoearwanda.com/checkout/txn_2024_8001"
                      expires_at:
                        type: string
                        format: date-time
                        example: "2024-03-01T11:15:00Z"

  # REVIEWS ENDPOINTS
  /reviews:
    post:
      summary: Create a review
      tags: [Reviews]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [listing_id, rating_overall, comment]
              properties:
                listing_id:
                  type: integer
                  example: 5001
                booking_id:
                  type: integer
                  example: 8001
                rating_overall:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                rating_quality:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                rating_value:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 4
                rating_service:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                rating_experience:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                comment:
                  type: string
                  example: "Excellent stay! The staff was very helpful."
                review_photos:
                  type: array
                  items:
                    type: string
                  example: ["https://cdn.zoearwanda.com/reviews/1/photo1.jpg"]
      responses:
        '201':
          description: Review created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'

  # MERCHANT ENDPOINTS
  /merchants/{merchant_id}/analytics:
    get:
      summary: Get merchant analytics
      tags: [Merchants]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: merchant_id
          required: true
          schema:
            type: integer
        - in: query
          name: period
          schema:
            type: string
            enum: [daily, weekly, monthly]
            default: monthly
        - in: query
          name: start_date
          schema:
            type: string
            format: date
        - in: query
          name: end_date
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Analytics retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      visits:
                        type: integer
                        example: 1250
                      orders:
                        type: integer
                        example: 89
                      bookings:
                        type: integer
                        example: 45
                      revenue:
                        type: number
                        format: float
                        example: 12500.50
                      period:
                        type: string
                        example: "monthly"

tags:
  - name: Authentication
    description: User registration and authentication
  - name: Listings
    description: Browse and search listings
  - name: Bookings
    description: Manage bookings and reservations
  - name: Payments
    description: Payment processing
  - name: Reviews
    description: User reviews and ratings
  - name: Users
    description: User profile and preferences
  - name: Merchants
    description: Merchant management
  - name: Agents
    description: Agent program management